"use strict";angular.module("scannabis",["ngAnimate","ngAria","ngResource","ngTouch","ui.router","firebase","uploader"]),angular.module("scannabis").directive("auth",function(){return{templateUrl:"scripts/directives/auth/auth-d.html",restrict:"EA"}}),angular.module("scannabis").directive("coin",function(){return{templateUrl:"scripts/directives/coin/coin-d.html",restrict:"EA",scope:{},link:function(e,a,t){},controller:["$scope",function(e){}]}}),angular.module("scannabis").directive("delivery",function(){return{templateUrl:"scripts/directives/delivery/delivery-d.html",restrict:"EA"}}),angular.module("scannabis").directive("dna",function(){return{templateUrl:"scripts/directives/dna/dna-d.html",restrict:"EA"}}),angular.module("scannabis").directive("news",function(){return{templateUrl:"scripts/directives/news/news-d.html",restrict:"EA",scope:{},link:function(e,a,t){},controller:["$scope",function(e){}]}}),angular.module("scannabis").directive("products",function(){return{templateUrl:"scripts/directives/products/products-d.html",restrict:"EA"}}),angular.module("scannabis").directive("reviews",function(){return{templateUrl:"scripts/directives/reviews/reviews-d.html",restrict:"EA"}}),angular.module("scannabis").directive("scannabis",["Data",function(e){return{templateUrl:"scripts/directives/scannabis/scannabis-d.html",restrict:"EA",scope:{},controller:["$scope",function(a){a.data=e}]}}]),angular.module("scannabis").directive("shop",function(){return{templateUrl:"scripts/directives/shop/shop-d.html",restrict:"EA"}}),angular.module("scannabis").directive("users",function(){return{templateUrl:"scripts/directives/users/users-d.html",restrict:"EA"}});var fb=Firebase,fbRef="https://scannabis.firebaseio.com/";angular.module("scannabis").factory("Data",["$firebaseObject","$firebaseArray","$firebaseAuth",function(e,a,t){var i={methods:{},data:{},auth:{}};return i.methods={getData:function(){var e=new fb(fbRef),s=t(e),n=s.$getAuth();n?a(e).$loaded().then(function(e){i.data.users=e.$getRecord("users"),i.auth=n}):console.log("Logged out")},login:function(e){var a=new fb(fbRef),s=t(a);s.$authWithPassword({email:e.email,password:e.pass}).then(function(e){i.methods.getData()})["catch"](function(e){console.error("Authentication failed:",e)})},register:function(a){var s=new fb(fbRef),n=t(s);n.$createUser({email:a.email,password:a.pass}).then(function(e){return console.log("User "+e.uid+" created successfully!"),n.$authWithPassword({email:a.email,password:a.pass})}).then(function(t){var n=s.child("users");e(n).$loaded().then(function(e){a.pass=null,e[t.uid]=a,e.$save()});i.methods.getData()})["catch"](function(e){console.error("Error: ",e)})},logout:function(){var e=new fb(fbRef),a=t(e);a.$unauth(),i.data.users={}},save:function(a,t,i){var s=fbRef+a+"/"+t,n=new fb(s),r=e(n);r.$value=i,r.$save()},add:function(e,t,s){if(i.methods.getData(),null!==s)var n=fbRef+"users/"+i.auth.uid+"/public/"+e;else var n=fbRef+"users/"+s+"/public/"+e;var n=fbRef+"users/"+i.auth.uid+"/public/"+e,r=new fb(n),l=a(r);l.$add(t).then(function(){i.methods.getData()})}},i.methods.getData(),i}]);var uploader=angular.module("uploader",[]);uploader.provider("AWSControl",function(){var e=[];this.yeah="Hi",this.dataImg="",this.supportType=function(a){e.push(a)},this.$get=["$q","$rootScope","$firebase",function(a,t,i){return{dataImg:this.dataImg,mimes:e,canHandle:function(e){for(var a=!1,t=0;t<this.mimes.length;t++)a||!e.match(this.mimes[t].type)||(a=!0);return a},upload:function(e,s){console.log("file: ",e),console.log("key: ",s);var n=s;t.dataImg=e;var r=Date.now();s=s.toLowerCase().replace(/'+/g,"").replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"-").replace(/^-+|-+$/g,""),s=s+"-"+r+".png";var l=-1;if(angular.forEach(this.mimes,function(e,a){-1===l&&(l=a)}),-1===l)return!1;var c=a.defer(),o=this.mimes[l];if("s3"===o.host){var u={Key:s,ContentType:e.type,Body:e};AWS.config.update({accessKeyId:o.accessKeyId,secretAccessKey:o.secretAccessKey}),AWS.config.region=o.region,AWS.config.host=o.host;var d=new AWS.S3({params:{Bucket:o.Bucket}});return d.putObject(u,function(e,a){if(e)t.$broadcast("AWSUploadError"),c.reject(e);else{t.$broadcast("AWSUploadSuccess"),c.resolve(a),t.newImage="https://"+AWS.config.host+"-"+AWS.config.region+".amazonaws.com/"+o.Bucket+"/"+encodeURIComponent(s),t.mediaTitle=n,t.mediaThumbs={},t.mediaDescription="Vancouver Metalwork",t.mediaTitle=t.mediaTitle.toLowerCase().replace(/'+/g,"").replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"-").replace(/^-+|-+$/g,""),t.mediaTags=[n];var r=new Firebase("https://metal.firebaseio.com/media"),l=i(r);l.$push({mediaThumbs:t.smallMedia,mediaURL:t.newImage,mediaTitle:t.mediaTitle,mediaLink:t.mediaTitle.toLowerCase().replace(/'+/g,"").replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"-").replace(/^-+|-+$/g,""),mediaDescription:t.mediaDescription,mediaTags:t.mediaTags}).then(function(e){var a=e.name(),s=new Firebase("https://metal.firebaseio.com/index/media"),n=i(s);n.$set(t.mediaTitle,a)})}}),c.promise}alert("No handler")}}}]}),uploader.directive("uploader",["AWSControl","$rootScope",function(e,a){return{replace:!0,scope:{},template:'<form novalidate ><input class="well" type="file" multiple="multiple" id="yourInput" /><button class="btn btn-behance" id="upIt" data-ng-click="upload()">Upload</button></form>',restrict:"E",link:function(t,i){t.upload=function(){for(var s=document.getElementById("yourInput").files.length,n=0;s>n;n++){var r=i[0].children[0],l=r.files[n];i[0].children[1].disabled=!0,i[0].children[1].innerHTML="Uploading...",e.canHandle(l.type)?(t.reader=new FileReader,t.reader.onload=function(i){return t.reader.readAsDataURL(l),setTimeout(function(){e.dataImg=t.reader.result}),function(e){console.log("-- RESULT",e.target.result,"-- NAME:",i.name),function(t){var i=document.createElement("canvas"),s=i.getContext("2d"),r=t,l=[60,100,160];a.smallMedia={};var t=new Image;return t.src=r,angular.forEach(l,function(e){n=t.width/e,i.width=e,i.height=t.height/n,s.drawImage(t,0,0,i.width,i.height),a.smallMedia[e]=i.toDataURL()}),e.target.result}(e.target.result)}}(l),e.upload(l,l.name).then(function(e){i[0].reset(),i[0].children[1].disabled=!1,i[0].children[1].innerHTML="Upload",console.log("data from aws upload call",e)},function(e){i[0].children[1].disabled=!1,i[0].children[1].innerHTML="Upload",console.log(e)},function(e){})):(i[0].children[1].disabled=!1,i[0].children[1].innerHTML="Upload",alert("Generic alert or some notification about an unsupported file type"))}}}}}]),angular.module("scannabis").config(["$stateProvider","$urlRouterProvider",function(e,a){e.state("scannabis.test",{url:"test",template:"<scannabis></scannabis>"}).state("scannabis",{url:"/",template:'<ul style="display: flex; width:100%"><li style="flex: 1 1 100px"><a ui-sref="scannabis.delivery">Delivery</a></li><li style="flex: 1 1 100px"><a ui-sref="scannabis.market">Market</a></li><li style="flex: 1 1 100px"><a ui-sref="scannabis.pos">POS</a></li><li style="flex: 1 1 100px"><a ui-sref="scannabis.strains">Strains</a></li></ul><ui-view></ui-view><ul style="display: flex; width:100%"><li style="flex: 1 1 100px"><a ui-sref="scannabis.news">News</a></li><li style="flex: 1 1 100px"><a ui-sref="scannabis.auth">auth</a></li><li style="flex: 1 1 100px"><a ui-sref="scannabis.coin">coin</a></li><li style="flex: 1 1 100px"><a ui-sref="scannabis.users">Users</a></li></ul>',controller:["$scope","Data",function(e,a){e.data=a}]}).state("scannabis.market",{url:"market",template:"<shop></shop><reviews></reviews>"}).state("scannabis.auth",{url:"auth",template:"<auth></auth>"}).state("scannabis.pos",{url:"pos",template:"<products></products><reviews></reviews>"}).state("scannabis.strains",{url:"strains",template:"<dna></dna>"}).state("scannabis.delivery",{url:"delivery",template:"<delivery></delivery>"}).state("scannabis.news",{url:"news",template:"<news></news>"}).state("scannabis.users",{url:"users",template:"<users></users>"}).state("scannabis.coin",{url:"coins",template:"<coin></coin>"}),a.otherwise("/")}]);